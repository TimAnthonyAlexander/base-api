---
description:
globs:
alwaysApply: true
---
BaseApi is a tiny, KISS-first PHP 8.4 framework for building JSON-first APIs with almost no ceremony: explicit routes via a simple $app->get()/post()/delete() array DSL, small homegrown Request/Response, controllers that declare public typed properties (auto-bound from route/query/body/files), optional mini validation, and responses wrapped in a .data envelope. It ships a minimal global pipeline (error handler, request ID, CORS allowlist, JSON parsing, sessions), optional per-route rate limiting, and straightforward file uploads to public/private buckets. Persistence centers on a lean BaseModel (UUIDv7 CHAR(36), created_at/updated_at), a pragmatic PDO-backed QueryBuilder, and model-driven migrations that diff models to MySQL and apply changes. Conveniences include pagination/sort/filter conventions, ETag/cache helpers, a /health endpoint, and a zero-dependency CLI for serving and migrationsâ€”while deliberately skipping heavy PSR stacks, DI containers, and magic relations to keep everything readable, explicit, and strong together.

# BaseApi Project Structure

```
baseapi/
â”œâ”€â”€ ğŸ“ app/                           # Core application code
â”‚   â”œâ”€â”€ App.php                       # Main application class
â”‚   â”œâ”€â”€ Config.php                    # Configuration management
â”‚   â”œâ”€â”€ Logger.php                    # Logging functionality
â”‚   â”œâ”€â”€ Route.php                     # Route definition
â”‚   â”œâ”€â”€ Router.php                    # Request routing
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ Console/                   # CLI commands and console application
â”‚   â”‚   â”œâ”€â”€ Application.php           # Console application entry point
â”‚   â”‚   â”œâ”€â”€ Command.php               # Base command class
â”‚   â”‚   â””â”€â”€ ğŸ“ Commands/              # Individual CLI commands
â”‚   â”‚       â”œâ”€â”€ MakeControllerCommand.php  # Generate controllers
â”‚   â”‚       â”œâ”€â”€ MakeModelCommand.php       # Generate models
â”‚   â”‚       â”œâ”€â”€ MigrateApplyCommand.php    # Apply migrations
â”‚   â”‚       â”œâ”€â”€ MigrateGenerateCommand.php # Generate migrations
â”‚   â”‚       â””â”€â”€ ServeCommand.php           # Development server
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ Controllers/               # HTTP request handlers
â”‚   â”‚   â”œâ”€â”€ Controller.php            # Base controller class
â”‚   â”‚   â”œâ”€â”€ GetOnlyController.php     # Read-only controller base
â”‚   â”‚   â”œâ”€â”€ HealthController.php      # Health check endpoint
â”‚   â”‚   â”œâ”€â”€ TestController.php        # Testing controller
â”‚   â”‚   â””â”€â”€ UserController.php        # User management
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ Database/                  # Database layer and migrations
â”‚   â”‚   â”œâ”€â”€ Connection.php            # Database connection management
â”‚   â”‚   â”œâ”€â”€ DB.php                    # Database utilities
â”‚   â”‚   â”œâ”€â”€ DbException.php           # Database-specific exceptions
â”‚   â”‚   â”œâ”€â”€ QueryBuilder.php          # SQL query builder
â”‚   â”‚   â””â”€â”€ ğŸ“ Migrations/            # Database migration system
â”‚   â”‚       â”œâ”€â”€ ColumnDef.php         # Column definition
â”‚   â”‚       â”œâ”€â”€ DatabaseIntrospector.php # Database schema inspection
â”‚   â”‚       â”œâ”€â”€ DatabaseSchema.php    # Schema representation
â”‚   â”‚       â”œâ”€â”€ DiffEngine.php        # Schema comparison
â”‚   â”‚       â”œâ”€â”€ ForeignKeyDef.php     # Foreign key definition
â”‚   â”‚       â”œâ”€â”€ IndexDef.php          # Index definition
â”‚   â”‚       â”œâ”€â”€ MigrationPlan.php     # Migration execution plan
â”‚   â”‚       â”œâ”€â”€ MigrationsFile.php    # Migration file handling
â”‚   â”‚       â”œâ”€â”€ ModelScanner.php      # Model introspection
â”‚   â”‚       â”œâ”€â”€ ModelSchema.php       # Model schema definition
â”‚   â”‚       â”œâ”€â”€ SqlGenerator.php      # SQL generation
â”‚   â”‚       â””â”€â”€ TableDef.php          # Table definition
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ Http/                      # HTTP handling and middleware
â”‚   â”‚   â”œâ”€â”€ BinaryResponse.php        # Binary file responses
â”‚   â”‚   â”œâ”€â”€ ControllerInvoker.php     # Controller execution
â”‚   â”‚   â”œâ”€â”€ CorsMiddleware.php        # CORS handling
â”‚   â”‚   â”œâ”€â”€ ErrorHandler.php          # Global error handling
â”‚   â”‚   â”œâ”€â”€ JsonBodyParserMiddleware.php # JSON request parsing
â”‚   â”‚   â”œâ”€â”€ JsonResponse.php          # JSON response formatting
â”‚   â”‚   â”œâ”€â”€ Kernel.php                # HTTP kernel
â”‚   â”‚   â”œâ”€â”€ Middleware.php            # Base middleware
â”‚   â”‚   â”œâ”€â”€ Request.php               # HTTP request wrapper
â”‚   â”‚   â”œâ”€â”€ RequestIdMiddleware.php   # Request ID generation
â”‚   â”‚   â”œâ”€â”€ Response.php              # HTTP response wrapper
â”‚   â”‚   â”œâ”€â”€ SessionStartMiddleware.php # Session management
â”‚   â”‚   â”œâ”€â”€ UploadedFile.php          # File upload handling
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ Binding/               # Request binding system
â”‚   â”‚   â”‚   â”œâ”€â”€ ControllerBinder.php  # Controller parameter binding
â”‚   â”‚   â”‚   â””â”€â”€ TypeCoercion.php      # Type conversion utilities
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ Middleware/            # Additional middleware
â”‚   â”‚   â”‚   â”œâ”€â”€ OptionedMiddleware.php # Configurable middleware base
â”‚   â”‚   â”‚   â””â”€â”€ RateLimitMiddleware.php # Rate limiting
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ Validation/            # Request validation
â”‚   â”‚       â”œâ”€â”€ ValidationException.php # Validation errors
â”‚   â”‚       â””â”€â”€ Validator.php         # Validation logic
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ Models/                    # Data models
â”‚   â”‚   â””â”€â”€ BaseModel.php             # Base model with UUIDv7, timestamps
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ Support/                   # Utility classes
â”‚       â”œâ”€â”€ ClientIp.php              # Client IP detection
â”‚       â”œâ”€â”€ RateLimiter.php           # Rate limiting utilities
â”‚       â””â”€â”€ Uuid.php                  # UUID generation
â”‚
â”œâ”€â”€ ğŸ“ bin/                           # Executable scripts
â”‚   â””â”€â”€ console                       # CLI entry point
â”‚
â”œâ”€â”€ ğŸ“ config/                        # Configuration files
â”‚   â””â”€â”€ app.php                       # Application configuration
â”‚
â”œâ”€â”€ ğŸ“ public/                        # Web-accessible files
â”‚   â”œâ”€â”€ index.php                     # Web entry point
â”‚   â””â”€â”€ router.php                    # Development server router
â”‚
â”œâ”€â”€ ğŸ“ routes/                        # Route definitions
â”‚   â””â”€â”€ api.php                       # API routes
â”‚
â”œâ”€â”€ ğŸ“ storage/                       # File storage (uploads, logs, cache)
â”‚
â”œâ”€â”€ ğŸ“ tests/                         # Test suite
â”‚   â””â”€â”€ ExampleTest.php               # Example test
â”‚
â”œâ”€â”€ ğŸ“ vendor/                        # Composer dependencies
â”‚   â”œâ”€â”€ autoload.php                  # Composer autoloader
â”‚   â””â”€â”€ [various packages...]         # Third-party libraries
â”‚
â”œâ”€â”€ composer.json                     # Composer configuration
â”œâ”€â”€ composer.lock                     # Dependency lock file
â”œâ”€â”€ phpunit.xml.dist                  # PHPUnit configuration
â””â”€â”€ README.md                         # Project documentation
```

## Key Architecture Components

### ğŸ—ï¸ **Core Framework** (`app/`)
- **App.php**: Main application bootstrap and configuration
- **Router.php**: Request routing and middleware pipeline
- **Kernel.php**: HTTP request/response lifecycle management

### ğŸ® **Controllers** (`app/Controllers/`)
- Auto-binding of route/query/body parameters to public typed properties
- Extends base `Controller` or `GetOnlyController` for read-only operations
- Built-in validation and response formatting

### ğŸ—„ï¸ **Database** (`app/Database/`)
- **BaseModel**: UUIDv7 primary keys, created_at/updated_at timestamps
- **QueryBuilder**: Fluent SQL query construction
- **Migrations**: Model-driven schema diffing and application

### ğŸŒ **HTTP Layer** (`app/Http/`)
- **Request/Response**: Lightweight HTTP abstractions
- **Middleware**: CORS, rate limiting, JSON parsing, sessions
- **Binding**: Automatic parameter binding with type coercion
- **Validation**: Built-in request validation system

### ğŸ› ï¸ **CLI Tools** (`app/Console/`)
- **serve**: Development server
- **make:controller**: Generate controllers
- **make:model**: Generate models
- **migrate:generate**: Create migrations from model changes
- **migrate:apply**: Apply pending migrations

### ğŸ“‚ **Entry Points**
- **public/index.php**: Web application entry
- **bin/console**: CLI commands entry
- **routes/api.php**: Route definitions

## Framework Philosophy

BaseApi follows a **KISS-first** approach:
- âœ… Explicit over implicit (no magic)
- âœ… Minimal ceremony and boilerplate
- âœ… JSON-first API design
- âœ… Type-safe parameter binding
- âœ… Pragmatic database layer
- âœ… Zero-dependency core (except dev tools)
- âŒ No heavy PSR stacks
- âŒ No DI containers
- âŒ No complex ORM relations
