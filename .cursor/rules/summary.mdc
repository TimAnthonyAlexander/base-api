---
description:
globs:
alwaysApply: true
---

# BaseApi

**BaseApi** is a tiny, KISS-first PHP 8.4 framework for building JSON-first APIs with almost no ceremony.

## Core Principles

- **Explicit Routes**  
  Define routes via a simple `$app->get()`, `post()`, `delete()` array DSL.

- **Lightweight HTTP Layer**  
  Small homegrown `Request`/`Response` objects.  
  Controllers declare **public typed properties** (auto-bound from route/query/body/files).

- **Validation & Responses**  
  Optional mini validation.  
  Responses wrapped in a `.data` envelope for consistency.

## Built-in Pipeline

- Global error handler
- Request ID injection
- CORS allowlist
- JSON body parsing
- Sessions (with session-based authentication)

## Authentication

- Pluggable `UserProvider`
- Optional per-route rate limiting
- Login/logout endpoints with session management
- Authentication middleware for route protection

## File Uploads

- Straightforward file uploads to public/private buckets

## Persistence

- **BaseModel** with:
  - UUIDv7 `CHAR(36)` primary key
  - `created_at` / `updated_at` timestamps
- **QueryBuilder**: pragmatic PDO-backed
- **Model-driven migrations**: diff models to MySQL and apply schema changes

## Developer Conveniences

- Pagination / sort / filter conventions
- ETag & cache helpers for 304 responses and `Cache-Control` optimization
- `/health` endpoint
- Zero-dependency CLI for serving and migrations

## Philosophy

BaseApi deliberately skips heavy PSR stacks, DI containers, and magic relationsâ€”  
keeping everything **readable, explicit, and strong together**.
